name: Merge Group Analysis (Phase 2 Detector)

# Ce workflow prouve l'hypoth√®se : il se d√©clenche sur merge_group
# C'est la Phase 2 - test des groupes combin√©s apr√®s que les PR aient pass√© leurs checks individuels
on:
  merge_group:

jobs:
  analyze-merge-queue-flow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Analyze Merge Group (Phase 2 - Batching Detection)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üéØ MERGE GROUP DETECTED - PHASE 2 BATCHING!"
          echo "==========================================="
          echo ""
          echo "‚úÖ HYPOTHESIS CONFIRMED!"
          echo "This workflow runs on 'merge_group' - proving Phase 2 exists!"
          echo ""
          echo "üìä Event: ${{ github.event_name }}"
          echo "ÔøΩ Merge Group Head SHA: ${{ github.sha }}"
          echo "üïê Timestamp: $(date)"
          echo ""
          
          echo "üîç MERGE GROUP ANALYSIS:"
          echo "------------------------"
          echo "This merge_group event means:"
          echo "‚Ä¢ Phase 1 (individual checks) COMPLETED for some PRs"
          echo "‚Ä¢ Phase 2 (group batching) is NOW STARTING"
          echo "‚Ä¢ Multiple PRs are being tested together as one unit"
          echo ""
          
          echo "ÔøΩ PROOF OF TWO-PHASE SYSTEM:"
          echo "-----------------------------"
          echo "‚Ä¢ ci.yml ran on individual PRs (pull_request events)"
          echo "‚Ä¢ Now queue.yml is running on the combined group (merge_group event)"
          echo "‚Ä¢ This IS the batching phase you hypothesized!"
          echo ""
          
          echo "üßÆ GROUP COMPOSITION:"
          echo "--------------------"
          echo "This merge group contains PRs that:"
          echo "‚Ä¢ Already passed their individual status checks"
          echo "‚Ä¢ Were batched together based on Group Size settings"
          echo "‚Ä¢ Are now being tested as a combined unit"
          echo ""
          
          echo "‚ö° CURRENT GROUP HEAD SHA: ${{ github.sha }}"
          echo "This SHA represents the combined changes from multiple PRs"
          
          echo ""
          echo "üé≠ PHASE DETECTION:"
          echo "------------------"
          echo "Phase 1 (Individual): Look for 'pull_request' event runs"
          echo "Phase 2 (Batching): Look for 'merge_group' event runs"
          
          echo ""
          echo "üí° This workflow proves the two-phase hypothesis!"
          echo "   It runs AFTER individual status checks complete"
          echo "   and shows when PRs become eligible for batching"